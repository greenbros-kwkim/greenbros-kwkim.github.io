"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e="Trimble.dispatcher.v1",t={},n={};let o=1;function r(e){const t=u();return n[t]=e,()=>delete n[t]}function i(n,o,r,i,s=1e4){return new Promise(((c,a)=>{const p=u(),f={scope:e,type:"request",id:p,api:r,args:i};let d;s>0&&(d=setTimeout((()=>{delete t[p],a(new Error("dispatcher.ts | sendRequest(): Operation timed out."))}),s)),t[p]=e=>{delete t[p],d&&clearTimeout(d),e.error?a(e.error):c(e.result)},n.postMessage(f,o)}))}function s(t,n,o,r){const i={scope:e,type:"event",event:o,data:r};t.postMessage(i,n)}async function c(o){const r=o.source,i="null"===o.origin?"*":o.origin,s=o.data;if(function(e){return a(e)&&"event"===e.type}(s))for(const e in n){if(!n.hasOwnProperty(e))continue;const t=n[e].event;t&&t(r,i,s.event,s.data)}else if(function(e){return a(e)&&"request"===e.type}(s)){let t;for(const o in n){if(!n.hasOwnProperty(o))continue;const c=n[o].request;if(c&&!t){const n=c(r,i,s.api,s.args);if(void 0!==n)try{t={scope:e,type:"response",id:s.id,api:s.api,result:await n}}catch(n){t={scope:e,type:"response",id:s.id,api:s.api,error:String(n)}}}}t||(t={scope:e,type:"response",id:s.id,api:s.api,error:"Not supported"}),r.postMessage(t,i)}else if(function(e){return a(e)&&"response"===e.type}(s)){const e=t[s.id];e&&e(s)}}function a(t){return!!t&&t.scope===e}function u(){return o++}const p={},f=[];let d;const l=new Promise((e=>{d=()=>{d=()=>{},e()}}));let w;function g(e){if("object"!=typeof e)throw new Error("Api must be an object");v(p,e),d()}function y(e,t){return"function"==typeof e&&"function"==typeof t&&e.name===t.name||("string"==typeof e&&"string"==typeof t||"number"==typeof e&&"number"==typeof t)}function v(e,t){for(const n in t){const o=t[n];if(o)if(n in e){const t=e[n];if("object"==typeof o&&"object"==typeof t)v(t,o);else{if(!y(o,t))throw new Error(`Cannot merge ${n} (${t} and ${o})`);e[n]=o}}else switch(typeof o){case"object":{const t={};v(t,o),e[n]=t;break}default:e[n]=o}}}function m(e,t,n){const o={};for(const r in e){const i=e[r];if((void 0!==n||"onConnect"!==r&&"onRequest"!==r)&&i)if("object"==typeof i){const e=n&&n+"."+String(r)||String(r);o[r]=m(i,t,e)}else o[r]=t(r,e[r],n)}return o}var h,b;r({request:(e,t,n,o)=>{if(".connect_api_client_v1"===n)return l.then((()=>{let n=f.find((t=>t.dispatcher===e));if(n)n.origin=t;else{if(!e)return;n={dispatcher:e,origin:t},f.push(n)}var o;return(o=p)&&"function"==typeof o.onConnect&&p.onConnect(n),m(p,((e,t)=>"function"==typeof t?".api_function_v1":t))}));{const i=f.find((n=>n.dispatcher===e&&n.origin===t));if(i){if((r=p)&&"function"==typeof r.onRequest){const e=p.onRequest(i,n,o);if(void 0!==e)return e}const e=function(e,t){const n=t.split(".");let o=e;for(const e of n)o="object"==typeof o&&o&&e in o?o[e]:void 0;return o}(p,n);if("function"==typeof e){const t=e.apply(void 0,o);return void 0===t?Promise.resolve(t):t}return Promise.resolve(e)}return}var r}}),exports.PropertyType=void 0,(h=exports.PropertyType||(exports.PropertyType={}))[h.LengthMeasure=0]="LengthMeasure",h[h.AreaMeasure=1]="AreaMeasure",h[h.VolumeMeasure=2]="VolumeMeasure",h[h.MassMeasure=3]="MassMeasure",h[h.AngleMeasure=4]="AngleMeasure",h[h.StringValue=5]="StringValue",h[h.IntValue=6]="IntValue",h[h.DoubleValue=7]="DoubleValue",h[h.DateTime=8]="DateTime",h[h.Logical=9]="Logical",h[h.Boolean=10]="Boolean",exports.ViewEntityStates=void 0,(b=exports.ViewEntityStates||(exports.ViewEntityStates={}))[b.Selected=1]="Selected",b[b.Hidden=4]="Hidden",b[b.SelectedHidden=5]="SelectedHidden",b[b.Visible=6]="Visible",b[b.SelectedVisible=7]="SelectedVisible",b[b.Highlighted=8]="Highlighted";var S;function M(e){return c(e)}exports.SortDirection=void 0,(S=exports.SortDirection||(exports.SortDirection={}))[S.SORT_NONE=0]="SORT_NONE",S[S.SORT_UP=1]="SORT_UP",S[S.SORT_DOWN=-1]="SORT_DOWN",exports.TOOLS=["reset","selection","areaSelection","measurement","pointMarkup","cloudMarkup","arrowMarkup","lineMarkup","textMarkup","freelineMarkup","clipPlane","verticalClipPlane","picking"],exports.TOOL_SNAP_TYPES=["edge","point","surface"],exports.connect=function(e,t,n){return window.removeEventListener("message",M),window.addEventListener("message",M),w&&w(),function(e,t,n=1e4){async function o(e,t){const o=await i(e,t,".connect_api_client_v1",[],0);if(o&&"object"==typeof o)return m(o,((o,r,s)=>{if(".api_function_v1"===r){const r=s?s+"."+String(o):String(o);return(...o)=>i(e,t,r,o,n)}return r}));throw new Error("Failed to connect")}function s(e){if(!e)return"*";try{return new URL(e).origin}catch(e){return"*"}}if(t&&(w=r({event:(e,n,o,r)=>t(o,r)})),e===window)return 0!==Object.keys(p).length?Promise.resolve(p):function(){const e=window;return e&&"CefSharp"in e}()?new Promise((async e=>{await CefSharp.BindObjectAsync("connectWsApiIntegrator");const t={postMessage:(e,t)=>{const n=JSON.stringify(e);connectWsApiIntegrator.postMessage(n)}};e(await o(t,"*"))})):function(){const e=window;return e&&e.chrome&&e.chrome.webview}()?o({postMessage:(e,t)=>{window.chrome.webview.postMessage(e)}},"*"):Promise.resolve(p);if((c=e)&&"function"==typeof c.postMessage)return o(e,"*");if(function(e){return e&&"object"==typeof e.contentWindow}(e)){const t=[];return t.push(new Promise(((t,n)=>{const r=async()=>{e.removeEventListener("load",r),e.contentWindow?t(await o(e.contentWindow,s(e.src))):n(new Error("Cannot access the target content window"))};e.addEventListener("load",r)}))),e.contentWindow&&t.push(o(e.contentWindow,s(e.src))),Promise.race(t)}return Promise.reject(new Error("Target must be a window or an iframe"));var c}(e,t,n)},exports.dispatcherEventListener=M,exports.expose=function(e){return g(e)},exports.getConnectEmbedUrl=function(e="prod"){return`https://${{int:"web.int",qa:"web.qa",stage:"web.stage",prod:"web"}[e]}.connect.trimble.com?isEmbedded=true`},exports.isApplicationEmbedded=function(){try{return window.self!==window.top}catch(e){return!0}},exports.preregister=function(e){const t=f.find((t=>t.dispatcher===e.dispatcher));return t?(t.identifier=e.identifier||t.identifier,t.origin=e.origin||t.origin,t):e.dispatcher?(f.push(e),e):void 0},exports.removeClient=function(e){const t=f.findIndex((t=>t.dispatcher===e.dispatcher));-1!==t&&f.splice(t,1)},exports.sendEvent=function(e,t,n,o){s(e,t,n,o)},exports.sendEventToAllClients=function(e,t={},n){for(const o of f)!o.origin||n&&o!==n||s(o.dispatcher,o.origin,e,t)};
