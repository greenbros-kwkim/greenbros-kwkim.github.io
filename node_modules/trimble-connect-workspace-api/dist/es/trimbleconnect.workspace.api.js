const e="Trimble.dispatcher.v1",n={},t={};let o=1;function r(e){const n=u();return t[n]=e,()=>delete t[n]}function i(t,o,r,i,s=1e4){return new Promise(((c,a)=>{const f=u(),p={scope:e,type:"request",id:f,api:r,args:i};let d;s>0&&(d=setTimeout((()=>{delete n[f],a(new Error("dispatcher.ts | sendRequest(): Operation timed out."))}),s)),n[f]=e=>{delete n[f],d&&clearTimeout(d),e.error?a(e.error):c(e.result)},t.postMessage(p,o)}))}function s(n,t,o,r){const i={scope:e,type:"event",event:o,data:r};n.postMessage(i,t)}async function c(o){const r=o.source,i="null"===o.origin?"*":o.origin,s=o.data;if(function(e){return a(e)&&"event"===e.type}(s))for(const e in t){if(!t.hasOwnProperty(e))continue;const n=t[e].event;n&&n(r,i,s.event,s.data)}else if(function(e){return a(e)&&"request"===e.type}(s)){let n;for(const o in t){if(!t.hasOwnProperty(o))continue;const c=t[o].request;if(c&&!n){const t=c(r,i,s.api,s.args);if(void 0!==t)try{n={scope:e,type:"response",id:s.id,api:s.api,result:await t}}catch(t){n={scope:e,type:"response",id:s.id,api:s.api,error:String(t)}}}}n||(n={scope:e,type:"response",id:s.id,api:s.api,error:"Not supported"}),r.postMessage(n,i)}else if(function(e){return a(e)&&"response"===e.type}(s)){const e=n[s.id];e&&e(s)}}function a(n){return!!n&&n.scope===e}function u(){return o++}const f={},p=[];let d;const l=new Promise((e=>{d=()=>{d=()=>{},e()}}));let w;function g(e){if("object"!=typeof e)throw new Error("Api must be an object");M(f,e),d()}function y(e){const n=p.find((n=>n.dispatcher===e.dispatcher));return n?(n.identifier=e.identifier||n.identifier,n.origin=e.origin||n.origin,n):e.dispatcher?(p.push(e),e):void 0}function h(e){const n=p.findIndex((n=>n.dispatcher===e.dispatcher));-1!==n&&p.splice(n,1)}function m(e,n={},t){for(const o of p)!o.origin||t&&o!==t||s(o.dispatcher,o.origin,e,n)}function v(){try{return window.self!==window.top}catch(e){return!0}}function b(e,n){return"function"==typeof e&&"function"==typeof n&&e.name===n.name||("string"==typeof e&&"string"==typeof n||"number"==typeof e&&"number"==typeof n)}function M(e,n){for(const t in n){const o=n[t];if(o)if(t in e){const n=e[t];if("object"==typeof o&&"object"==typeof n)M(n,o);else{if(!b(o,n))throw new Error(`Cannot merge ${t} (${n} and ${o})`);e[t]=o}}else switch(typeof o){case"object":{const n={};M(n,o),e[t]=n;break}default:e[t]=o}}}function S(e,n,t){const o={};for(const r in e){const i=e[r];if((void 0!==t||"onConnect"!==r&&"onRequest"!==r)&&i)if("object"==typeof i){const e=t&&t+"."+String(r)||String(r);o[r]=S(i,n,e)}else o[r]=n(r,e[r],t)}return o}var O,P;r({request:(e,n,t,o)=>{if(".connect_api_client_v1"===t)return l.then((()=>{let t=p.find((n=>n.dispatcher===e));if(t)t.origin=n;else{if(!e)return;t={dispatcher:e,origin:n},p.push(t)}var o;return(o=f)&&"function"==typeof o.onConnect&&f.onConnect(t),S(f,((e,n)=>"function"==typeof n?".api_function_v1":n))}));{const i=p.find((t=>t.dispatcher===e&&t.origin===n));if(i){if((r=f)&&"function"==typeof r.onRequest){const e=f.onRequest(i,t,o);if(void 0!==e)return e}const e=function(e,n){const t=n.split(".");let o=e;for(const e of t)o="object"==typeof o&&o&&e in o?o[e]:void 0;return o}(f,t);if("function"==typeof e){const n=e.apply(void 0,o);return void 0===n?Promise.resolve(n):n}return Promise.resolve(e)}return}var r}}),function(e){e[e.LengthMeasure=0]="LengthMeasure",e[e.AreaMeasure=1]="AreaMeasure",e[e.VolumeMeasure=2]="VolumeMeasure",e[e.MassMeasure=3]="MassMeasure",e[e.AngleMeasure=4]="AngleMeasure",e[e.StringValue=5]="StringValue",e[e.IntValue=6]="IntValue",e[e.DoubleValue=7]="DoubleValue",e[e.DateTime=8]="DateTime",e[e.Logical=9]="Logical",e[e.Boolean=10]="Boolean"}(O||(O={})),function(e){e[e.Selected=1]="Selected",e[e.Hidden=4]="Hidden",e[e.SelectedHidden=5]="SelectedHidden",e[e.Visible=6]="Visible",e[e.SelectedVisible=7]="SelectedVisible",e[e.Highlighted=8]="Highlighted"}(P||(P={}));const _=["reset","selection","areaSelection","measurement","pointMarkup","cloudMarkup","arrowMarkup","lineMarkup","textMarkup","freelineMarkup","clipPlane","verticalClipPlane","picking"],E=["edge","point","surface"];var j;function T(e="prod"){return`https://${{int:"web.int",qa:"web.qa",stage:"web.stage",prod:"web"}[e]}.connect.trimble.com?isEmbedded=true`}function V(e,n,t){return window.removeEventListener("message",k),window.addEventListener("message",k),w&&w(),function(e,n,t=1e4){async function o(e,n){const o=await i(e,n,".connect_api_client_v1",[],0);if(o&&"object"==typeof o)return S(o,((o,r,s)=>{if(".api_function_v1"===r){const r=s?s+"."+String(o):String(o);return(...o)=>i(e,n,r,o,t)}return r}));throw new Error("Failed to connect")}function s(e){if(!e)return"*";try{return new URL(e).origin}catch(e){return"*"}}if(n&&(w=r({event:(e,t,o,r)=>n(o,r)})),e===window)return 0!==Object.keys(f).length?Promise.resolve(f):function(){const e=window;return e&&"CefSharp"in e}()?new Promise((async e=>{await CefSharp.BindObjectAsync("connectWsApiIntegrator");const n={postMessage:(e,n)=>{const t=JSON.stringify(e);connectWsApiIntegrator.postMessage(t)}};e(await o(n,"*"))})):function(){const e=window;return e&&e.chrome&&e.chrome.webview}()?o({postMessage:(e,n)=>{window.chrome.webview.postMessage(e)}},"*"):Promise.resolve(f);if((c=e)&&"function"==typeof c.postMessage)return o(e,"*");if(function(e){return e&&"object"==typeof e.contentWindow}(e)){const n=[];return n.push(new Promise(((n,t)=>{const r=async()=>{e.removeEventListener("load",r),e.contentWindow?n(await o(e.contentWindow,s(e.src))):t(new Error("Cannot access the target content window"))};e.addEventListener("load",r)}))),e.contentWindow&&n.push(o(e.contentWindow,s(e.src))),Promise.race(n)}return Promise.reject(new Error("Target must be a window or an iframe"));var c}(e,n,t)}function R(e){return g(e)}function q(e,n,t,o){s(e,n,t,o)}function k(e){return c(e)}!function(e){e[e.SORT_NONE=0]="SORT_NONE",e[e.SORT_UP=1]="SORT_UP",e[e.SORT_DOWN=-1]="SORT_DOWN"}(j||(j={}));export{O as PropertyType,j as SortDirection,_ as TOOLS,E as TOOL_SNAP_TYPES,P as ViewEntityStates,V as connect,k as dispatcherEventListener,R as expose,T as getConnectEmbedUrl,v as isApplicationEmbedded,y as preregister,h as removeClient,q as sendEvent,m as sendEventToAllClients};
